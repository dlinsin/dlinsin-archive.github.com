<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<html>
<head>
  <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <title>David Linsin - ShareKit Pimping</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="author" content="David Linsin" />
  <link href="http://dlinsin.github.com/atom.xml" rel="alternate" title="ShareKit Pimping" type="application/atom+xml" />
</head>

<body>

<a href="http://github.com/dlinsin"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://assets2.github.com/img/5d21241b64dc708fcbb701f68f72f41e9f1fadd6?repo=&url=http%3A%2F%2Fs3.amazonaws.com%2Fgithub%2Fribbons%2Fforkme_left_red_aa0000.png&path=" alt="Fork me on GitHub"></a>

<div class="site">
  <div class="title">
    <a href="/">Home</a>
  </div>
  
  <link rel="me" type="text/html" href="http://www.google.com/profiles/dlinsin"/>
  
  <div id="post">
  <h1> ShareKit Pimping </h1>
  <p class="meta"> 15 February 2011 </p> 
  
<p>A couple of months ago, I <a href='http://dlinsin.blogspot.com/2010/11/word-buzz-getting-better-twitter.html'>improved Word Buzz' Twitter sharing feature</a> significantly, by leveraging a <a href='https://github.com/dlinsin/iphone-twitter'>tweaked version</a> of an existing framework. Unfortunately, I had only heard of <a href='http://getsharekit.com'>ShareKit</a> at that time, that&#8217;s the reason why I decided to implement my own solution!</p>

<p>In case you don&#8217;t know about ShareKit or like me only heard about it:</p>

<blockquote>
<p>SharKit adds full sharing capabilities to your App. It&#8217;s a drop-in library, which supports services like Twitter, Facebook, Instapaper and many more. You can share links, text and pictures with a customizable user interface. It evens queues shared items until an internet connection is available.</p>
</blockquote>

<p>SharKit is awesome and I really regret not using it to add Twitter sharing to <a href='http://itunes.apple.com/app/word-buzz/id388372038?mt=8'>Word Buzz</a>. It has a well documented API and is really easy to extend, there&#8217;s even a step-by-step guide on ShakreKit&#8217;s website, which describes the process. I followed that guide to add <a href='https://github.com/dlinsin/ShareKit'>TwitPic and yfrog capability</a> to ShareKit for one of our next <a href='http://twitter.com/furryfishApps'>furryfishApps</a> projects and that&#8217;s what I&#8217;d like to write about in this post.</p>

<p>ShareKit comes with built-in Twitter support, which you can find in <em>SHKTwitter</em> and its authentication form <em>SHKTwitterForm</em>. It uses <a href='http://bit.ly'>bit.ly</a> to share images, which has a similar API as TwitPic and yfrog. I piggybacked on that implementation, however dropped oAuth support in favor of xAuth.</p>

<p>I know there are <a href='http://hueniverse.com/2010/06/xauth-a-terrible-horrible-no-good-very-bad-idea/'>a lot of discussions</a> on xAuth, however I found it the <a href='http://www.reynoldsftw.com/2010/03/using-xauth-an-alternate-oauth-from-twitter/'>easiest way</a> to provide the most benefit for iPhone App users, without compromising security in a hurtful way. In order to get your iPhone App ready to use xAuth with Twitter, you need to sign up at <a href='http://developer.twitter.com/'>http://developer.twitter.com/</a>. I described the process in a <a href='http://dlinsin.blogspot.com/2010/11/word-buzz-getting-better-twitter.html'>previous post</a>.</p>

<p>The previously mentioned class <em>SHKTwitter</em> inherits from <em>SHKOAuthSharer</em>, which does all the heavy lifting in terms of authentication for you! All you need to do is hook into the API calls and customize your authentication screen:</p>
<div class='highlight'><pre><code class='objectivec'><span class='k'>return</span> <span class='p'>[</span><span class='n'>NSArray</span> <span class='nl'>arrayWithObjects:</span>
  <span class='p'>[</span><span class='n'>SHKFormFieldSettings</span> <span class='nl'>label:</span><span class='n'>SHKLocalizedString</span><span class='p'>(</span><span class='s'>@&quot;Username&quot;</span><span class='p'>)</span> <span class='nl'>key:</span><span class='s'>@&quot;username&quot;</span> 
    <span class='nl'>type:</span><span class='n'>SHKFormFieldTypeText</span> <span class='nl'>start:</span><span class='nb'>nil</span><span class='p'>],</span>
  <span class='p'>[</span><span class='n'>SHKFormFieldSettings</span> <span class='nl'>label:</span><span class='n'>SHKLocalizedString</span><span class='p'>(</span><span class='s'>@&quot;Password&quot;</span><span class='p'>)</span> <span class='nl'>key:</span><span class='s'>@&quot;password&quot;</span> 
    <span class='nl'>type:</span><span class='n'>SHKFormFieldTypePassword</span> <span class='nl'>start:</span><span class='nb'>nil</span><span class='p'>],</span>
  <span class='p'>[</span><span class='n'>SHKFormFieldSettings</span> <span class='nl'>label:</span><span class='n'>SHKLocalizedString</span><span class='p'>(</span><span class='s'>@&quot;Send to Twitter&quot;</span><span class='p'>)</span> 
    <span class='nl'>key:</span><span class='s'>@&quot;sendToTwitter&quot;</span> <span class='nl'>type:</span><span class='n'>SHKFormFieldTypeSwitch</span> <span class='nl'>start:</span><span class='n'>SHKFormFieldSwitchOn</span><span class='p'>],</span><span class='nb'>nil</span><span class='p'>];</span>
</code></pre>
</div><a href='https://gist.github.com/827260' class='gist'>gist</a>
<p>So let&#8217;s say the user wants to share a picture, taps on the share icon and select TwitPic. He authenticates after being prompt for his Twitter credentials. When the authentication was successful, you want to show some sort of form to your users, where they can enter a comment or in case of Twitter, their status. You can totally customize the UI, without any dependency to ShareKit. In fact <em>SHKTwitterForm</em>, ShareKits built-in Twitter form, is a simple <em>UIViewController</em> with its delegate set to <em>SHKTwitter</em>.</p>

<p>The actual sharing part of the code is as straight forward as the rest of ShareKit. It&#8217;s a little verbose, but once your understood the concept, it&#8217;s easy to extend:</p>
<div class='highlight'><pre><code class='objectivec'><span class='o'>-</span> <span class='p'>(</span><span class='kt'>void</span><span class='p'>)</span><span class='n'>sendImage</span> <span class='p'>{</span>

<span class='n'>NSString</span> <span class='o'>*</span> <span class='n'>oauthHeader</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>self</span> <span class='n'>oauthHeader</span><span class='p'>];</span>

<span class='n'>NSURL</span> <span class='o'>*</span><span class='n'>serviceURL</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>NSURL</span> <span class='nl'>URLWithString:</span><span class='s'>@&quot;http://yfrog.com/api/xauth_upload&quot;</span><span class='p'>];</span>
<span class='n'>OAMutableURLRequest</span> <span class='o'>*</span><span class='n'>oRequest</span> <span class='o'>=</span> <span class='p'>[[</span><span class='n'>OAMutableURLRequest</span> <span class='n'>alloc</span><span class='p'>]</span> <span class='nl'>initWithURL:</span><span class='n'>serviceURL</span>
<span class='nl'>consumer:</span><span class='n'>super</span><span class='p'>.</span><span class='n'>consumer</span>
<span class='nl'>token:</span><span class='n'>super</span><span class='p'>.</span><span class='n'>accessToken</span>
<span class='nl'>realm:</span><span class='s'>@&quot;http://api.twitter.com/&quot;</span>
<span class='nl'>signatureProvider:</span><span class='n'>super</span><span class='p'>.</span><span class='n'>signatureProvider</span><span class='p'>];</span>

<span class='p'>[</span><span class='n'>oRequest</span> <span class='n'>prepare</span><span class='p'>];</span>
<span class='p'>[</span><span class='n'>oRequest</span> <span class='nl'>setValue:</span><span class='nb'>nil</span> <span class='nl'>forHTTPHeaderField:</span><span class='s'>@&quot;Authorization&quot;</span><span class='p'>];</span>

<span class='p'>[</span><span class='n'>oRequest</span> <span class='nl'>setHTTPMethod:</span><span class='s'>@&quot;POST&quot;</span><span class='p'>];</span>
<span class='p'>[</span><span class='n'>oRequest</span> <span class='nl'>setValue:</span><span class='s'>@&quot;https://api.twitter.com/1/account/verify_credentials.json&quot;</span> 
  <span class='nl'>forHTTPHeaderField:</span><span class='s'>@&quot;X-Auth-Service-Provider&quot;</span><span class='p'>];</span>
<span class='p'>[</span><span class='n'>oRequest</span> <span class='nl'>setValue:</span><span class='n'>oauthHeader</span> 
  <span class='nl'>forHTTPHeaderField:</span><span class='s'>@&quot;X-Verify-Credentials-Authorization&quot;</span><span class='p'>];</span>

<span class='n'>NSString</span> <span class='o'>*</span><span class='n'>boundary</span> <span class='o'>=</span> <span class='s'>@&quot;a21ff70823f9&quot;</span><span class='p'>;</span>
<span class='n'>NSString</span> <span class='o'>*</span><span class='n'>contentType</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>NSString</span> <span class='nl'>stringWithFormat:</span><span class='s'>@&quot;multipart/form-data; </span>
                                                  <span class='n'>boundary</span><span class='o'>=%</span><span class='s'>@&quot;,boundary];</span>
<span class='p'>[</span><span class='n'>oRequest</span> <span class='nl'>setValue:</span><span class='n'>contentType</span> <span class='nl'>forHTTPHeaderField:</span><span class='s'>@&quot;Content-Type&quot;</span><span class='p'>];</span>

<span class='n'>NSMutableData</span> <span class='o'>*</span><span class='n'>body</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>NSMutableData</span> <span class='n'>data</span><span class='p'>];</span>

<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[[</span><span class='n'>NSString</span> <span class='nl'>stringWithFormat:</span><span class='s'>@&quot;--%@</span><span class='se'>\r\n</span><span class='s'>&quot;</span><span class='p'>,</span><span class='n'>boundary</span><span class='p'>]</span> 
  <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>
<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[</span><span class='s'>@&quot;Content-Disposition: form-data; name=</span><span class='se'>\&quot;</span><span class='s'>key</span><span class='se'>\&quot;\r\n\r\n</span><span class='s'>&quot;</span> 
  <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>
<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[</span><span class='n'>self</span><span class='p'>.</span><span class='n'>yfrogAPIKey</span> <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>
<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[</span><span class='s'>@&quot;</span><span class='se'>\r\n</span><span class='s'>&quot;</span> <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>

<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[[</span><span class='n'>NSString</span> <span class='nl'>stringWithFormat:</span><span class='s'>@&quot;--%@</span><span class='se'>\r\n</span><span class='s'>&quot;</span><span class='p'>,</span><span class='n'>boundary</span><span class='p'>]</span> 
  <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>
<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[</span><span class='s'>@&quot;Content-Disposition: form-data; name=</span><span class='se'>\&quot;</span><span class='s'>media</span><span class='se'>\&quot;</span><span class='s'>; </span>
  <span class='n'>filename</span><span class='o'>=</span><span class='err'>\</span><span class='s'>&quot;upload.jpg</span><span class='se'>\&quot;\r\n</span><span class='s'>&quot;</span> 
  <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>
<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[</span><span class='s'>@&quot;Content-Type: image/jpg</span><span class='se'>\r\n\r\n</span><span class='s'>&quot;</span> 
  <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>
<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[</span><span class='n'>self</span> <span class='n'>imageData</span><span class='p'>]];</span>
<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[</span><span class='s'>@&quot;</span><span class='se'>\r\n</span><span class='s'>&quot;</span> <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>

<span class='p'>[</span><span class='n'>body</span> <span class='nl'>appendData:</span><span class='p'>[[</span><span class='n'>NSString</span> <span class='nl'>stringWithFormat:</span><span class='s'>@&quot;--%@--</span><span class='se'>\r\n</span><span class='s'>&quot;</span><span class='p'>,</span><span class='n'>boundary</span><span class='p'>]</span> 
  <span class='nl'>dataUsingEncoding:</span><span class='n'>NSUTF8StringEncoding</span><span class='p'>]];</span>

<span class='p'>[</span><span class='n'>oRequest</span> <span class='nl'>setHTTPBody:</span><span class='n'>body</span><span class='p'>];</span>

<span class='p'>[</span><span class='n'>self</span> <span class='n'>sendDidStart</span><span class='p'>];</span>

<span class='c1'>// Start the request</span>
<span class='n'>OAAsynchronousDataFetcher</span> <span class='o'>*</span><span class='n'>fetcher</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>OAAsynchronousDataFetcher</span> 
<span class='nl'>asynchronousFetcherWithRequest:</span><span class='n'>oRequest</span>
<span class='nl'>delegate:</span><span class='n'>self</span>
<span class='nl'>didFinishSelector:</span><span class='k'>@selector</span><span class='p'>(</span><span class='nl'>sendImage:didFinishWithData:</span><span class='p'>)</span>
<span class='nl'>didFailSelector:</span><span class='k'>@selector</span><span class='p'>(</span><span class='nl'>sendImage:didFailWithError:</span><span class='p'>)];</span>

<span class='p'>[</span><span class='n'>fetcher</span> <span class='n'>start</span><span class='p'>];</span>

<span class='p'>[</span><span class='n'>oRequest</span> <span class='n'>release</span><span class='p'>];</span>
<span class='p'>}</span>
</code></pre>
</div><a href='https://gist.github.com/827294' class='gist'>gist</a>
<p>As you can see most of the work goes into setting up the authentication headers for the request, as well as filling in the elements of the request body. There are APIs like <a href='http://allseeing-i.com/ASIHTTPRequest'>ASIHTTPRequest</a>, which handle this for you, however ShareKit doesn&#8217;t use them and I didn&#8217;t want to introduce a 3rd party library. If you take a look at <a href='https://github.com/Gurpartap/GSTwitPicEngine'>Gurpartap's TwitPic engine</a>, you can see how easy and simple the code would be.</p>

<p>Overall it&#8217;s a breeze to develop with <a href='http://getsharekit.com'>SharKit</a> and I&#8217;m glad I digged in deeper. For our next project we&#8217;ll definitely use it and you should at least take a look at it before rolling your own implementation.</p>

  </div>

  <div class="footer">
    <div class="contact">
      <p>
        mail: dlinsin@gmail.com<br/>
        jabber: dlinsin@gmail.com<br/>
      </p>
    </div>
    <div class="contact">
      <p>
        skype: dlinsin<br/>
        twitter: furryfishApps
      </p>
    </div>
    <div class="contact">
      <p>
        github: dlinsin<br/>
      </p>
    </div>
  </div>
  
</div>
</body>
</html>